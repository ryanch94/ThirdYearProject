<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <!-- Bootstrap Core CSS -->
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="../css/custom.css" rel="stylesheet" />

    <!--jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular-resource.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular-route.min.js"></script>

    <!-- font awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Sign Me In</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="#">My Account</a>
                    </li>
                    <li>
                        <a href="#">Timetable</a>
                    </li>
                    <li>
                        <a href="#">Attendance</a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a data-toggle="modal" data-target="#login" href="#" ><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
   <div class="container-fluid ">
       <div class="row" style="background-color:#3A78A4;height:450px;margin-top:50px;">
           <div class="col-lg-4">

               <ul style="margin-top:20px;"class="list-group" id="timetableToday">
                   <li class="list-group-item t1">9:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">10:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">11:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">12:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">13:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">14:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">15:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">16:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">17:00<span></span><span class="badge"></span></li>
                   <li class="list-group-item t1">18:00<span></span><span class="badge"></span></li>
               </ul>
           </div>
           <div class="col-lg-4">
               <div class="row" style="height:50px">
                   <div class="btn-group" role="group" aria-label="..." style="margin-top:20px;">
                       <button type="button" class="btn btn-default">Lab</button>
                       <button type="button" class="btn btn-default">Classroom</button>
                       <button type="button" class="btn btn-default">Lecture Hall</button>
                       <div class="btn-group" role="group">
                           <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                               Time
                               <span class="caret"></span>
                           </button>
                           <ul class="dropdown-menu">
                               <li><a href="#">9:00</a></li>
                               <li><a href="#">10:00</a></li>
                               <li><a href="#">11:00</a></li>
                               <li><a href="#">12:00</a></li>
                               <li><a href="#">13:00</a></li>
                               <li><a href="#">14:00</a></li>
                               <li><a href="#">15:00</a></li>
                               <li><a href="#">16:00</a></li>
                               <li><a href="#">17:00</a></li>
                               <li><a href="#">18:00</a></li>
                           </ul>
                       </div>
                       <div class="btn-group" role="group">
                           <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                               Misc
                               <span class="caret"></span>
                           </button>
                           <ul class="dropdown-menu">
                               <li><a href="#">Visual Studio</a></li>
                               <li><a href="#">Solid Works</a></li>
                               <li><a href="#">Photoshop</a></li>
                               <li><a href="#">Mamp/Wamp</a></li>
                               <li><a href="#">Steam</a></li>
                               <li><a href="#">Illustrator</a></li>
                               <li><a href="#">Dreamweaver</a></li>
                               <li><a href="#">Lightbox</a></li>
                           </ul>
                       </div>
                   </div>
                   <div class="col-lg-2"></div>
               </div>
               <div class="row">
                   <div id="freeRoomsList" class="list-group" style="margin-top:20px;max-height: 360px;overflow-y:scroll; ">
                   </div>
               </div>
           </div>
           <div class="col-lg-1"></div>
       </div>

       <!--Free Rooms Modal-->
       <div id="freeRoomModal" class="modal fade " role="dialog">
           <div class="modal-dialog modal-sm">

               <!-- Modal content-->
               <div class="modal-content">
                   <div class="modal-header ">
                       <button type="button" class="close" data-dismiss="modal">&times;</button>
                       <h4 class="modal-title">Room Details <i id="watchStar" style="float:right;margin-right:30px;color:red" title="Click me to watch this room!" class="fa fa-star fa-2x"></i></h4>
                   </div>
                   <div class="modal-body">
                       <!--<p style="border:1px red solid;border-radius:3px;padding:10px;">Click the star if you would like to watch this room </p>-->
                     <h4>Room Number:B1041</h4>
                     <h4>Room Count:22</h4>
                     <h4>Room Type:Lab</h4>
                   </div>
                   <div class="modal-footer">
                       <button type="button" class="btn btn-link btn-group" data-toggle="modal" data-dismiss="modal" data-target="#login">Already a member?</button>
                       <button type="button" class="btn btn-default btn-group" data-dismiss="modal">Close</button>
                       <button type="submit" class="btn btn-success btn-group" onclick="newUser()" data-dismiss="modal">Register</button>
                   </div>
               </div>

           </div>
       </div>
   </div>


    
    <!-- jQuery -->
    <script src="../Scripts/jquery-1.9.1.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="../Scripts/bootstrap.min.js"></script>
    <script>

       

        //Populates the modal window that appears when you click a room
        $('#freeRoomsList button').click(function () {
            alert("Test");
        });

        //Populates a list with all rooms that are free now
        function getFreeRooms() {
            // Ajax request to get all free rooms

            $.ajax({
                 url: "https://signmeinwebapi.azurewebsites.net/api/FreeRooms",
                type: "GET",
                headers: {
                    "Authorization": "bearer " + localStorage.getItem("authToken")
                },
                success: function (data) {
                
                    //grab all rows of list for free rooms
                    var freeRoomsList = document.getElementById('freeRoomsList');
                    
                    //loops through all rooms
                    for (i = 0; i < data.length; i++) {
                        //create new list item
                        newListItem = document.createElement('button');
                        newListItem.setAttribute('data-toggle', 'modal');
                        newListItem.setAttribute('data-target', '#freeRoomModal');
                        newListItem.setAttribute('href', '#');
                       // newListItem.setAttribute('onclick', 'freeRoomModal(this.text)');
                        newListItem.setAttribute('type', 'button');
                        newListItem.setAttribute('class', 'list-group-item');
                        newListItem.text =  data[i].Code;
                        newListItem.innerHTML = data[i].Code;
                        //append it to the ul
                        freeRoomsList.appendChild(newListItem);
                    }
                },
                error: function (jqXHR) {
                    alert('error loading free rooms');
                }
            });
        }
         
        //writes out todays timetable
        function formatTimetable(Timetable) {
            for (i = 0; i < Timetable.length; i++) {
                //get num of today and compare against weeks timetable
                var day = new Date();
                var todayNum = (day.getDay()) + 1;
                //if sat/sun day is monday
                if (todayNum == 7 || todayNum == 1)
                {
                    todayNum = 2;
                }
                //if class is on today
                if (Timetable[i].WeekDayNumber == todayNum) {
                    var time = Timetable[i].DayBlock;
                    var length = Timetable[i].ClassLength;
                    //grab all rows of table
                    var Timetablerows = document.getElementsByClassName('t1');
                    //if only an hour long class
                    if (length == 1) {
                        Timetablerows[(time - 1)].innerHTML =((time + 8) + ":00") + '<span>  ' + Timetable[i].ShortName + '</span><span class="badge">' + Timetable[i].Code + '</span>';
                    }
                    //if class 2 hours
                    else if (length == 2) {
                        Timetablerows[(time - 1)].innerHTML =((time + 8) + ":00") + '<span>  ' + Timetable[i].ShortName + '</span><span class="badge">' + Timetable[i].Code + '</span>';
                        Timetablerows[(time)].innerHTML =((time + 9) + ":00") + '<span>  ' + Timetable[i].ShortName + '</span><span class="badge">' + Timetable[i].Code + '</span>';
                    }

                }


            }
        }

        $(document).ready(

             
             
        
             
        function getTimetable() {

            $("#watchStar").hover(function () {
                $(this).removeClass("fa-2x");
                $(this).addClass("fa-3x");
            }, function () {
                $(this).removeClass("fa-3x");
                $(this).addClass("fa-2x");
            })

            getFreeRooms();
            var Timetablerows = document.getElementsByClassName('t1');
          
            // Ajax request to get user info
            var id = localStorage.getItem("UserID");
            var str1 = "https://signmeinwebapi.azurewebsites.net/api/timetables/";
            var str2 = String(id);
            var res = str1.concat(str2);

            $.ajax({

                url: res,
                type: "GET",
                headers: {
                    "Authorization": "bearer " + localStorage.getItem("authToken")
                },
                success: function (data) {
                    $("#test").html(JSON.stringify(data));
                    formatTimetable(data);
                },
                error: function (jqXHR) {
                    alert('error');
                }
            });
        })

        
       
    </script>
    <!--<script>
        //grabs the JSON file from WebAPI and puts it in scope.names
var app = angular.module('myApp', []);
app.controller('customersCtrl', function($scope, $http) {
    $http.get("http://signmeinwebapi.azurewebsites.net/api/timetables/8?dayOfWeek=3")
    .then(function (response) {
        $scope.names = response.data;
        //function to take a class and enter it in its particular row.
        function fillDays(element, index, array) {
            var time = $scope.names[index].DayBlock;
            var length = 2;
            //grab all rows of table
            var rows = document.getElementsByClassName('trow');
            //if only an hour long class
            if (length == 1) {
                rows[(time - 1)].innerHTML = '<div class="col-lg-4 col-xs-2">' + (time + 8 + ":00") + '</div><div class="col-lg-4 col-xs-6">' + element.Name + '</div><div class="col-lg-4 col-xs-4">' + element.Code + "</div>";
            }
            //if class 2 hours
            else if (length == 2) {
                rows[(time - 1)].innerHTML = '<div class="col-lg-4 col-xs-2">' + (time + 8 + ":00") + '</div><div class="col-lg-4 col-xs-6">' + element.Name + '</div><div class="col-lg-4 col-xs-4">' + element.Code + "</div>";
                rows[(time)].innerHTML = '<div class="col-lg-4 col-xs-2">' + (time + 9 + ":00") + '</div><div class="col-lg-4 col-xs-6">' + element.Name + '</div><div class="col-lg-4 col-xs-4">' + element.Code + "</div>";
            }
            //if class 3 hours
            else if (length == 3) {
                rows[(time - 1)].innerHTML = '<div class="col-lg-4 col-xs-2">' + (time + 8 + ":00") + '</div><div class="col-lg-4 col-xs-6">' + element.Name + '</div><div class="col-lg-4 col-xs-4">' + element.Code + "</div>";
                rows[(time)].innerHTML = '<div class="col-lg-4 col-xs-2">' + (time + 9 + ":00") + '</div><div class="col-lg-4 col-xs-6">' + element.Name + '</div><div class="col-lg-4 col-xs-4">' + element.Code + "</div>";
                rows[(time + 1)].innerHTML = '<div class="col-lg-4 col-xs-2">' + (time + 10 + ":00") + '</div><div class="col-lg-4 col-xs-6">' + element.Name + '</div><div class="col-lg-4 col-xs-4">' + element.Code + "</div>";
            }            
            

        }
        ($scope.names).forEach(fillDays);    


    });
    
});


    </script>-->
    <script>
        $(document).ready(function() {
            //var data = {};
            var data=[
           
                {"Name":"Maths", "Room":"b1041", "Length":"1","Starts":"9"}, 
                {"Name":"RAD", "Room":"B1042", "Length":"2","Starts":"10"}, 
                {"Name":"Web Prog","Room":"C1003", "Length":"1","Starts":"12"},
                {"Name":"Maths","Room":"b1041", "Length":"1","Starts":"2"}, 
                {"Name":"RAD", "Room":"B1042", "Length":"1","Starts":"3"}, 
                {"Name":"Web Prog","Room":"C1003", "Length":"2","Starts":"4"},
     
            ];
            //var id = 8;
            //var str1 = '"';
            //var str2 = "http://signmeinwebapi.azurewebsites.net/api/timetables/";
            //var str3 = String(id);
            //var str4 = "?dayOfWeek=2";
            //var str5 = '"';
            //var res = str1.concat(str2,str3,str4,str5);
            //alert(res);
            //$.getJSON(res).done(function (data2) {
            //    data = data2;
            });
      
    </script>
</body>
</html>
